<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Battle RPG</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: white;
            overflow: hidden;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            background: rgba(0, 0, 20, 0.85);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 2px solid #4a4af3;
            position: relative;
        }
        
        .screen {
            padding: 30px;
            display: none;
        }
        
        #start-screen {
            display: block;
            text-align: center;
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #f8d568;
            text-shadow: 0 0 10px rgba(248, 213, 104, 0.7);
            letter-spacing: 2px;
        }
        
        h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #4aafdf;
        }
        
        .rules {
            background: rgba(25, 25, 60, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
            border: 1px solid #4a4af3;
        }
        
        .rules h3 {
            color: #f8d568;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .rules ul {
            list-style-type: none;
            padding: 0 15px;
        }
        
        .rules li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }
        
        .rules li:before {
            content: "•";
            color: #4aafdf;
            position: absolute;
            left: 0;
            font-size: 1.5rem;
        }
        
        .input-group {
            margin: 25px 0;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2rem;
            color: #4aafdf;
        }
        
        input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border-radius: 10px;
            border: 2px solid #4a4af3;
            background: rgba(10, 10, 30, 0.8);
            color: white;
            text-align: center;
        }
        
        button {
            background: linear-gradient(to right, #ff8c00, #ff4500);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 69, 0, 0.4);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 69, 0, 0.6);
            background: linear-gradient(to right, #ff9d2d, #ff5e1a);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(25, 25, 60, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #4a4af3;
        }
        
        .player-info {
            text-align: center;
            flex: 1;
        }
        
        .turn-indicator {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(to right, #ff8c00, #ff4500);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.7);
            animation: pulse 1.5s infinite;
        }
        
        .hp-bar {
            width: 100%;
            height: 25px;
            background: #333;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid #444;
        }
        
        .hp-fill {
            height: 100%;
            background: linear-gradient(to right, #ff0000, #ff4500);
            border-radius: 10px;
            transition: width 0.5s;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .opponent-area, .player-area {
            background: rgba(25, 25, 60, 0.5);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #4a4af3;
            position: relative;
        }
        
        .card-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            min-height: 180px;
            padding: 20px 0;
        }
        
        .card {
            width: 100px;
            height: 150px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 2px solid #4a4af3;
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.5);
        }
        
        .card.selected {
            transform: translateY(-20px);
            box-shadow: 0 0 20px #ffcc00;
            border: 2px solid #ffcc00;
        }
        
        .card.wild {
            background: linear-gradient(135deg, #ff8c00, #ff4500);
        }
        
        .card.back {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .card.back:before {
            content: "";
            display: block;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="15" fill="%23b71c1c" stroke="%23ffcc00" stroke-width="3"/><circle cx="50" cy="50" r="30" fill="none" stroke="%23ffcc00" stroke-width="5"/><path d="M30,30 L70,70 M70,30 L30,70" stroke="%23ffcc00" stroke-width="5"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }
        
        .card-value {
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-suit {
            font-size: 2.5rem;
            text-align: center;
        }
        
        .card-name {
            font-size: 0.8rem;
            text-align: center;
            margin-top: 5px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 12px 30px;
            font-size: 1.1rem;
        }
        
        .draw-btn {
            background: linear-gradient(to right, #00c853, #009624);
        }
        
        .end-btn {
            background: linear-gradient(to right, #2962ff, #0039cb);
        }
        
        .battle-btn {
            background: linear-gradient(to right, #ff8c00, #ff4500);
            font-size: 1.3rem;
            padding: 15px 50px;
        }
        
        .battle-log {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            min-height: 120px;
            border: 1px solid #4a4af3;
            overflow-y: auto;
            max-height: 200px;
        }
        
        .log-entry {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .player-turn {
            color: #4aafdf;
        }
        
        .enemy-turn {
            color: #ff6b6b;
        }
        
        .damage {
            color: #ff4500;
            font-weight: bold;
        }
        
        .win {
            color: #4caf50;
        }
        
        .loss {
            color: #f44336;
        }
        
        .card-counter {
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
            display: inline-block;
        }
        
        .game-over {
            text-align: center;
            padding: 40px;
        }
        
        .game-over h2 {
            font-size: 3rem;
            margin-bottom: 30px;
        }
        
        .result-message {
            font-size: 2rem;
            margin: 30px 0;
            padding: 20px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .timer-container {
            position: absolute;
            top: -15px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid #ff4500;
        }
        
        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffcc00;
        }
        
        .timer-bar {
            width: 100px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .timer-fill {
            height: 100%;
            background: linear-gradient(to right, #00c853, #ffcc00);
            border-radius: 5px;
            transition: width 1s linear;
        }
        
        .deck-counter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 20px;
            border: 2px solid #ffcc00;
            font-weight: bold;
            z-index: 5;
        }
        
        .battle-table {
            position: relative;
            height: 180px;
            margin: 10px 0;
            background: rgba(30, 30, 70, 0.6);
            border-radius: 15px;
            border: 2px dashed #ffcc00;
            display: flex;
            justify-content: space-around;
            align-items: center;
            overflow: hidden;
        }
        
        .battle-zone {
            display: flex;
            gap: 10px;
            height: 100%;
            align-items: center;
        }
        
        .battle-card {
            width: 80px;
            height: 120px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            position: relative;
            border: 2px solid #4a4af3;
        }
        
        .battle-card.wild {
            background: linear-gradient(135deg, #ff8c00, #ff4500);
        }
        
        .battle-card.player {
            animation: slideInRight 0.5s forwards;
        }
        
        .battle-card.enemy {
            animation: slideInLeft 0.5s forwards;
        }
        
        .vs-badge {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(to right, #ff8c00, #ff4500);
            color: white;
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1.2rem;
            z-index: 10;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.7);
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100vw);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInLeft {
            from {
                transform: translateX(-100vw);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes battleEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); box-shadow: 0 0 30px #ffcc00; }
            100% { transform: scale(1); }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(255, 140, 0, 0.7); }
            50% { box-shadow: 0 0 20px rgba(255, 140, 0, 1); }
            100% { box-shadow: 0 0 10px rgba(255, 140, 0, 0.7); }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            h2 {
                font-size: 1.8rem;
            }
            
            .card {
                width: 80px;
                height: 120px;
            }
            
            .battle-card {
                width: 60px;
                height: 90px;
            }
            
            .card-value {
                font-size: 1.5rem;
            }
            
            .card-suit {
                font-size: 2rem;
            }
            
            .controls {
                flex-wrap: wrap;
            }
            
            .battle-btn {
                padding: 12px 30px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Layar Awal -->
        <div id="start-screen" class="screen">
            <h1><i class="fas fa-crown"></i> CARD BATTLE RPG</h1>
            <div class="rules">
                <h3><i class="fas fa-book"></i> Aturan Permainan</h3>
                <ul>
                    <li>Masukkan nama Anda untuk memulai petualangan</li>
                    <li>Setiap pemain memulai dengan 100 HP</li>
                    <li>Setiap giliran, Anda dapat mengambil maksimal 3 kartu</li>
                    <li>Maksimal kartu di tangan adalah 6</li>
                    <li>Pilih 1-3 kartu untuk menyerang musuh</li>
                    <li>Total nilai kartu yang lebih tinggi akan menang</li>
                    <li>Pemain yang kalah kehilangan HP sebesar selisih nilai</li>
                    <li>Kartu Wild memberikan nilai acak tambahan</li>
                    <li>Kalahkan musuh untuk memenangkan permainan!</li>
                </ul>
            </div>
            <div class="input-group">
                <label for="player-name"><i class="fas fa-user"></i> Nama Pemain</label>
                <input type="text" id="player-name" placeholder="Masukkan nama Anda" maxlength="15">
            </div>
            <button id="start-btn"><i class="fas fa-play"></i> MULAI PERMAINAN</button>
        </div>
        
        <!-- Layar Permainan -->
        <div id="game-screen" class="screen">
            <div class="turn-indicator" id="turn-indicator">GILIRAN ANDA</div>
            
            <div class="game-header">
                <div class="player-info">
                    <h2 id="player-name-display">Player</h2>
                    <div>HP: <span id="player-hp">100</span>/100</div>
                    <div class="hp-bar">
                        <div id="player-hp-bar" class="hp-fill" style="width: 100%"></div>
                    </div>
                    <div class="card-counter">Kartu: <span id="player-card-count">0</span>/6</div>
                </div>
                <div class="player-info">
                    <h2>MUSUH</h2>
                    <div>HP: <span id="enemy-hp">100</span>/100</div>
                    <div class="hp-bar">
                        <div id="enemy-hp-bar" class="hp-fill" style="width: 100%"></div>
                    </div>
                    <div class="card-counter">Kartu: <span id="enemy-card-count">0</span>/6</div>
                </div>
            </div>
            
            <div class="game-area">
                <div class="opponent-area">
                    <h3><i class="fas fa-fire"></i> Musuh</h3>
                    <div class="card-container" id="enemy-cards"></div>
                </div>
                
                <div class="battle-table">
                    <div class="deck-counter" id="deck-counter">Deck: 54</div>
                    <div class="battle-zone" id="player-battle-cards"></div>
                    <div class="vs-badge">VS</div>
                    <div class="battle-zone" id="enemy-battle-cards"></div>
                </div>
                
                <div class="player-area">
                    <div class="timer-container">
                        <i class="fas fa-clock"></i>
                        <div class="timer-bar">
                            <div id="timer-fill" class="timer-fill" style="width: 100%"></div>
                        </div>
                        <div class="timer" id="timer">30s</div>
                    </div>
                    
                    <h3><i class="fas fa-hand-paper"></i> Kartu Anda</h3>
                    <div class="card-container" id="player-cards"></div>
                    
                    <div class="controls">
                        <button id="draw-btn" class="action-btn draw-btn"><i class="fas fa-plus-circle"></i> Ambil Kartu (3)</button>
                        <button id="end-turn-btn" class="action-btn end-btn"><i class="fas fa-forward"></i> Akhiri Giliran</button>
                        <button id="battle-btn" class="action-btn battle-btn"><i class="fas fa-fist-raised"></i> SERANG!</button>
                    </div>
                </div>
            </div>
            
            <div class="battle-log">
                <h3><i class="fas fa-scroll"></i> Catatan Pertempuran</h3>
                <div id="log-container"></div>
            </div>
        </div>
        
        <!-- Layar Game Over -->
        <div id="game-over-screen" class="screen game-over">
            <h2>PERMAINAN SELESAI</h2>
            <div id="result-message" class="result-message">Anda Menang!</div>
            <button id="restart-btn"><i class="fas fa-redo"></i> MAIN LAGI</button>
        </div>
    </div>

    <script>
        // Data permainan
        const gameState = {
            playerName: "",
            playerHP: 100,
            enemyHP: 100,
            playerHand: [],
            enemyHand: [],
            deck: [],
            selectedCards: [],
            turn: 0,
            gameOver: false,
            log: [],
            hasDrawn: false,
            timer: 30,
            timerInterval: null
        };

        // Inisialisasi permainan
        function initGame(playerName) {
            gameState.playerName = playerName;
            gameState.playerHP = 100;
            gameState.enemyHP = 100;
            gameState.playerHand = [];
            gameState.enemyHand = [];
            gameState.selectedCards = [];
            gameState.turn = 0;
            gameState.gameOver = false;
            gameState.log = [];
            gameState.hasDrawn = false;
            
            // Reset timer
            clearInterval(gameState.timerInterval);
            gameState.timer = 30;
            
            // Buat deck kartu
            createDeck();
            shuffleDeck();
            
            // Bagikan kartu awal
            drawCards(gameState.playerHand, 3);
            drawCards(gameState.enemyHand, 3);
            
            // Tampilkan layar permainan
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            
            // Update UI
            updateUI();
            addLog("Permainan dimulai! " + playerName + " vs Musuh");
            
            // Mulai timer
            startTimer();
        }

        // Memulai timer
        function startTimer() {
            clearInterval(gameState.timerInterval);
            
            gameState.timer = 30;
            document.getElementById('timer').textContent = gameState.timer + 's';
            document.getElementById('timer-fill').style.width = '100%';
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer--;
                document.getElementById('timer').textContent = gameState.timer + 's';
                document.getElementById('timer-fill').style.width = (gameState.timer / 30 * 100) + '%';
                
                if (gameState.timer <= 0) {
                    clearInterval(gameState.timerInterval);
                    addLog("Waktu habis! Giliran berakhir.");
                    endTurn();
                }
            }, 1000);
        }

        // Membuat deck kartu
        function createDeck() {
            gameState.deck = [];
            const suits = ['♥', '♦', '♣', '♠'];
            const values = [
                {name: 'A', value: 1},
                {name: '2', value: 2},
                {name: '3', value: 3},
                {name: '4', value: 4},
                {name: '5', value: 5},
                {name: '6', value: 6},
                {name: '7', value: 7},
                {name: '8', value: 8},
                {name: '9', value: 9},
                {name: '10', value: 10},
                {name: 'J', value: 11},
                {name: 'Q', value: 12},
                {name: 'K', value: 13}
            ];
            
            // Tambahkan kartu standar
            for (let suit of suits) {
                for (let card of values) {
                    gameState.deck.push({
                        suit: suit,
                        name: card.name,
                        value: card.value,
                        displayName: card.name + suit,
                        isWild: false
                    });
                }
            }
            
            // Tambahkan kartu wild (2 buah)
            for (let i = 0; i < 2; i++) {
                gameState.deck.push({
                    suit: '★',
                    name: 'WILD',
                    value: 0,
                    displayName: 'WILD★',
                    isWild: true
                });
            }
        }

        // Acak deck
        function shuffleDeck() {
            for (let i = gameState.deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.deck[i], gameState.deck[j]] = [gameState.deck[j], gameState.deck[i]];
            }
        }

        // Mengambil kartu dari deck
        function drawCards(hand, count) {
            for (let i = 0; i < count; i++) {
                if (hand.length < 6 && gameState.deck.length > 0) {
                    hand.push(gameState.deck.pop());
                }
            }
            gameState.hasDrawn = true;
        }

        // Menambahkan log permainan
        function addLog(message, isPlayer = true) {
            const logClass = isPlayer ? 'player-turn' : 'enemy-turn';
            gameState.log.push(`<div class="log-entry ${logClass}">${message}</div>`);
            
            // Batasi log hanya 10 entri terakhir
            if (gameState.log.length > 10) {
                gameState.log.shift();
            }
            
            // Update tampilan log
            document.getElementById('log-container').innerHTML = gameState.log.join('');
        }

        // Memilih kartu
        function selectCard(index) {
            // Jika kartu sudah dipilih, batalkan pilihan
            if (gameState.selectedCards.includes(index)) {
                gameState.selectedCards = gameState.selectedCards.filter(i => i !== index);
            } 
            // Jika belum mencapai batas maksimal 3 kartu
            else if (gameState.selectedCards.length < 3) {
                gameState.selectedCards.push(index);
            }
            
            // Update UI
            updateCardSelection();
        }

        // Update tampilan pemilihan kartu
        function updateCardSelection() {
            const playerCards = document.querySelectorAll('#player-cards .card');
            playerCards.forEach((card, index) => {
                if (gameState.selectedCards.includes(index)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        // Serang musuh
        function attack() {
            if (gameState.selectedCards.length === 0) {
                addLog("Pilih setidaknya satu kartu untuk menyerang!");
                return;
            }
            
            // Kosongkan area pertempuran
            document.getElementById('player-battle-cards').innerHTML = '';
            document.getElementById('enemy-battle-cards').innerHTML = '';
            
            // Hitung total nilai kartu pemain
            let playerTotal = 0;
            let playerCards = [];
            let wildBonus = 0;
            
            // Sortir indeks secara descending untuk menghindari masalah saat menghapus
            const sortedIndices = [...gameState.selectedCards].sort((a, b) => b - a);
            
            for (let index of sortedIndices) {
                const card = gameState.playerHand[index];
                playerCards.push(card);
                
                // Hitung nilai kartu
                let cardValue = card.value;
                
                // Jika kartu wild, tambahkan bonus acak
                if (card.isWild) {
                    const bonus = Math.floor(Math.random() * 10) + 1;
                    wildBonus += bonus;
                    cardValue += bonus;
                }
                
                playerTotal += cardValue;
                
                // Hapus kartu dari tangan pemain
                gameState.playerHand.splice(index, 1);
                
                // Tambahkan kartu ke area pertempuran pemain
                const battleCard = createBattleCardElement(card, 'player');
                document.getElementById('player-battle-cards').appendChild(battleCard);
            }
            
            // Reset kartu yang dipilih
            gameState.selectedCards = [];
            
            // Musuh memilih kartu secara acak (1-3 kartu)
            const enemyCardCount = Math.min(Math.floor(Math.random() * 3) + 1, gameState.enemyHand.length);
            let enemyTotal = 0;
            let enemyCards = [];
            
            // Sortir indeks secara descending untuk menghindari masalah saat menghapus
            const enemyIndices = [];
            for (let i = 0; i < enemyCardCount; i++) {
                enemyIndices.push(i);
            }
            enemyIndices.sort((a, b) => b - a);
            
            for (let index of enemyIndices) {
                const card = gameState.enemyHand[index];
                enemyCards.push(card);
                enemyTotal += card.value;
                
                // Hapus kartu dari tangan musuh
                gameState.enemyHand.splice(index, 1);
                
                // Tambahkan kartu ke area pertempuran musuh
                const battleCard = createBattleCardElement(card, 'enemy');
                document.getElementById('enemy-battle-cards').appendChild(battleCard);
            }
            
            // Tentukan hasil pertempuran
            const diff = Math.abs(playerTotal - enemyTotal);
            let resultMessage = "";
            
            if (playerTotal > enemyTotal) {
                // Pemain menang, musuh kehilangan HP
                gameState.enemyHP -= diff;
                resultMessage = `${gameState.playerName} menang! ${diff} damage ke Musuh!`;
                if (wildBonus > 0) {
                    resultMessage += ` (Bonus Wild: +${wildBonus})`;
                }
            } else if (enemyTotal > playerTotal) {
                // Musuh menang, pemain kehilangan HP
                gameState.playerHP -= diff;
                resultMessage = `Musuh menang! ${diff} damage ke ${gameState.playerName}!`;
            } else {
                // Seri
                resultMessage = "Pertempuran seri! Tidak ada damage.";
            }
            
            // Tambahkan log
            addLog(`${gameState.playerName} menggunakan ${playerCards.length} kartu (Total: ${playerTotal})`);
            addLog(`Musuh menggunakan ${enemyCards.length} kartu (Total: ${enemyTotal})`, false);
            addLog(resultMessage);
            
            // Periksa apakah permainan berakhir
            checkGameOver();
            
            // Update UI
            updateUI();
            
            // Reset timer
            startTimer();
            
            // Tunggu 2 detik lalu kosongkan area pertempuran
            setTimeout(() => {
                document.getElementById('player-battle-cards').innerHTML = '';
                document.getElementById('enemy-battle-cards').innerHTML = '';
            }, 2000);
        }

        // Buat elemen kartu untuk pertempuran
        function createBattleCardElement(card, owner) {
            const cardEl = document.createElement('div');
            cardEl.className = `battle-card ${card.isWild ? 'wild' : ''} ${owner}`;
            
            // Tentukan warna berdasarkan jenis kartu
            const isRed = card.suit === '♥' || card.suit === '♦';
            
            cardEl.innerHTML = `
                <div class="card-value">${card.name}</div>
                <div class="card-suit">${card.suit}</div>
                <div class="card-name">${card.displayName}</div>
            `;
            
            return cardEl;
        }

        // Akhiri giliran
        function endTurn() {
            // Musuh mengambil kartu
            drawCards(gameState.enemyHand, 3);
            addLog("Musuh mengambil 3 kartu", false);
            
            // Reset kartu yang dipilih
            gameState.selectedCards = [];
            
            // Reset status pengambilan kartu
            gameState.hasDrawn = false;
            
            updateUI();
            addLog("Giliran berakhir. Giliran selanjutnya!");
            
            // Reset timer
            startTimer();
        }

        // Periksa apakah permainan berakhir
        function checkGameOver() {
            if (gameState.playerHP <= 0 || gameState.enemyHP <= 0) {
                gameState.gameOver = true;
                clearInterval(gameState.timerInterval);
                
                // Tentukan pemenang
                const winner = gameState.playerHP > 0 ? gameState.playerName : "Musuh";
                const resultMessage = winner === gameState.playerName ? 
                    `<span class="win">${winner} MENANG!</span>` : 
                    `<span class="loss">${winner} MENANG! Coba lagi!</span>`;
                
                // Tampilkan layar game over
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('game-over-screen').style.display = 'block';
                document.getElementById('result-message').innerHTML = resultMessage;
            }
        }

        // Update UI
        function updateUI() {
            // Update info pemain
            document.getElementById('player-name-display').textContent = gameState.playerName;
            document.getElementById('player-hp').textContent = gameState.playerHP;
            document.getElementById('player-hp-bar').style.width = `${gameState.playerHP}%`;
            document.getElementById('player-card-count').textContent = gameState.playerHand.length;
            
            // Update info musuh
            document.getElementById('enemy-hp').textContent = gameState.enemyHP;
            document.getElementById('enemy-hp-bar').style.width = `${gameState.enemyHP}%`;
            document.getElementById('enemy-card-count').textContent = gameState.enemyHand.length;
            
            // Update deck counter
            document.getElementById('deck-counter').textContent = `Deck: ${gameState.deck.length}`;
            
            // Tampilkan kartu pemain
            const playerCardsContainer = document.getElementById('player-cards');
            playerCardsContainer.innerHTML = '';
            
            gameState.playerHand.forEach((card, index) => {
                const cardEl = createCardElement(card);
                cardEl.onclick = () => selectCard(index);
                playerCardsContainer.appendChild(cardEl);
            });
            
            // Tampilkan kartu musuh (dalam keadaan tertutup)
            const enemyCardsContainer = document.getElementById('enemy-cards');
            enemyCardsContainer.innerHTML = '';
            
            gameState.enemyHand.forEach(() => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card back';
                enemyCardsContainer.appendChild(cardEl);
            });
            
            // Update pemilihan kartu
            updateCardSelection();
            
            // Update tombol
            document.getElementById('draw-btn').disabled = gameState.playerHand.length >= 6 || gameState.hasDrawn;
        }

        // Buat elemen kartu
        function createCardElement(card) {
            const cardEl = document.createElement('div');
            cardEl.className = `card ${card.isWild ? 'wild' : ''}`;
            
            // Tentukan warna berdasarkan jenis kartu
            const isRed = card.suit === '♥' || card.suit === '♦';
            const colorClass = isRed ? 'red' : 'black';
            
            cardEl.innerHTML = `
                <div class="card-value">${card.name}</div>
                <div class="card-suit">${card.suit}</div>
                <div class="card-name">${card.displayName}</div>
            `;
            
            return cardEl;
        }

        // Event listeners
        document.getElementById('start-btn').addEventListener('click', () => {
            const playerName = document.getElementById('player-name').value.trim();
            if (playerName) {
                initGame(playerName);
            } else {
                alert("Masukkan nama Anda terlebih dahulu!");
            }
        });
        
        document.getElementById('draw-btn').addEventListener('click', () => {
            drawCards(gameState.playerHand, 3);
            addLog(`${gameState.playerName} mengambil 3 kartu`);
            updateUI();
        });
        
        document.getElementById('battle-btn').addEventListener('click', attack);
        
        document.getElementById('end-turn-btn').addEventListener('click', endTurn);
        
        document.getElementById('restart-btn').addEventListener('click', () => {
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'block';
        });

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', () => {
            // Kosongkan input nama
            document.getElementById('player-name').value = "";
        });
    </script>
</body>
</html>